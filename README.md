# README

## Users ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‰
| ã‚«ãƒ©ãƒ å                   | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³                     | èª¬æ˜               |
| ---------------------- | ------- | ------------------------- | ---------------- |
| id                     | integer | primary key               | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID           |
| nickname               | string  | null: false               | ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ            |
| email                  | string  | null: false, unique\:true | ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹          |
| encrypted\_password    | string  | null: false               | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆdeviseç”¨ï¼‰   |
| kanji\_family\_name    | string  | null: false               | å§“ï¼ˆæ¼¢å­—ï¼‰            |
| kanji\_given\_name     | string  | null: false               | åï¼ˆæ¼¢å­—ï¼‰            |
| katakana\_family\_name | string  | null: false               | å§“ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰          |
| katakana\_given\_name  | string  | null: false               | åï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰          |
| birthday               | date    | null: false               | ç”Ÿå¹´æœˆæ—¥             |
| admin\_flag            | boolean | default: 0                | ç®¡ç†è€…ãƒ•ãƒ©ã‚°ï¼ˆ1\:adminï¼‰ |
| point                  | integer | null: false, default: 0   | æ‰€æŒãƒã‚¤ãƒ³ãƒˆ |

### ğŸ“ æ³¨æ„ï¼ˆ2025å¹´5æœˆ20æ—¥ è¿½è¨˜ï¼‰
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ‰€æŒãƒã‚¤ãƒ³ãƒˆã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã€`point` ã‚«ãƒ©ãƒ ï¼ˆintegerï¼‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚

## Items ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå•†å“æƒ…å ±ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜              |
| --------------- | ------- | ------------------ | --------------- |
| id              | integer | primary key        | å•†å“ID            |
| category\_id   | integer | null: false        | ã‚«ãƒ†ã‚´ãƒªãƒ¼   |
| name            | string  | null: false        | å•†å“å             |
| price           | integer | null: false        | ä¾¡æ ¼              |
| condition\_id  | integer | null: false        | å•†å“çŠ¶æ…‹    |
| description     | text    | null: false        | å•†å“èª¬æ˜            |

## Orders ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè³¼å…¥æƒ…å ±ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜                  |
| --------------- | ------- | ------------------ | ------------------- |
| id              | integer | primary key        | æ³¨æ–‡ID                |
| user        | references | null: false, foreign_key: true | è³¼å…¥è€…IDï¼ˆusers.idï¼‰     |
| item        | references | null: false, foreign_key: true | è³¼å…¥ã•ã‚ŒãŸå•†å“IDï¼ˆitems.idï¼‰ |
| used_point | integer | null: false, default: 0 | è³¼å…¥æ™‚ã«ä½¿ç”¨ã•ã‚ŒãŸãƒã‚¤ãƒ³ãƒˆ |
| coupon_assignment | references | **null: true**, foreign_key: true | è³¼å…¥æ™‚ã«ä½¿ç”¨ã•ã‚ŒãŸãƒã‚¤ãƒ³ãƒˆ |

### ğŸ“ æ³¨æ„ï¼ˆ2025å¹´5æœˆ20æ—¥ è¿½è¨˜ï¼‰

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå•†å“è³¼å…¥æ™‚ã« **ãƒã‚¤ãƒ³ãƒˆã‚’ä½¿ç”¨ã§ãã‚‹æ©Ÿèƒ½**ã‚’è¿½åŠ ã—ãŸã“ã¨ã«ä¼´ã„ã€`Orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `used_point` ã‚«ãƒ©ãƒ ï¼ˆ`integer`, `null: false`, `default: 0`ï¼‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚
- ã“ã‚Œã«ã‚ˆã‚Šã€å„æ³¨æ–‡ã”ã¨ã«ã€Œä½¿ç”¨ã•ã‚ŒãŸãƒã‚¤ãƒ³ãƒˆæ•°ã€ã‚’è¨˜éŒ²ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå•†å“è³¼å…¥æ™‚ã« **ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ç”¨ã§ãã‚‹æ©Ÿèƒ½**ã‚’è¿½åŠ ã—ãŸã“ã¨ã«ä¼´ã„ã€`Orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã« `coupon_assignment` ã‚«ãƒ©ãƒ ï¼ˆ`references`, `null: true`ï¼‰ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚
- â€» nullã®å ´åˆã¯ã‚¯ãƒ¼ãƒãƒ³ã‚’é©ç”¨ã—ã¦ã„ãªã„ã¨ã„ã†ã“ã¨ã‚’è¡¨ã™ã€‚



## Delivery_adress ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆé…é€å…ˆæƒ…å ±ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜                  |
| --------------- | ------- | ------------------ | ------------------- |
| id    | integer | primary key        | é…é€ID                |
| order    | references | null: false, foreign_key: true |  è³¼å…¥æƒ…å ±(order.id)              |
| postal\_code  | string | null: false | éƒµä¾¿ç•ªå·          |
| prefecture_id    | integer | null: false | éƒ½é“åºœçœŒ |
| city          | string | null: false | å¸‚åŒºç”ºæ‘          |
| address1      | string | null: false | ç•ªåœ°            |
| building      | string |             | å»ºç‰©åï¼ˆä»»æ„ï¼‰       |
| phone\_number | string | null: false | é›»è©±ç•ªå·          |

# ä»¥ä¸‹ã¯è¿½åŠ å®Ÿè£…ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã‚ã‚‹(2025/5/20 è¿½è¨˜)

## Favorites ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãŠæ°—ã«å…¥ã‚Šç™»éŒ²ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜                  |
| --------------- | ------- | ------------------ | ------------------- |
| id              | integer | primary key        | ãŠæ°—ã«å…¥ã‚ŠID                |
| user        | references | null: false, foreign_key: true | ãŠæ°—ã«å…¥ã‚Šç™»éŒ²è€…IDï¼ˆusers.idï¼‰     |
| item        | references | null: false, foreign_key: true | ãŠæ°—ã«å…¥ã‚Šã•ã‚ŒãŸå•†å“IDï¼ˆitems.idï¼‰ |

### ğŸ”’ ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€åŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹åŒä¸€å•†å“ã®é‡è¤‡ç™»éŒ²ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby
add_index :favorites, [:user_id, :item_id], unique: true
```

## Notice ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãŠçŸ¥ã‚‰ã›ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜                  |
| --------------- | ------- | ------------------ | ------------------- |
| id              | integer | primary key        | ãŠçŸ¥ã‚‰ã›ID                |
| title           | string  | null: false,       | ã‚¿ã‚¤ãƒˆãƒ«     |
| content         | text    | null: false,       | å†…å®¹ |

## Promotion ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãŠçŸ¥ã‚‰ã›ï¼‰
| ã‚«ãƒ©ãƒ å            | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³              | èª¬æ˜                  |
| --------------- | ------- | ------------------ | ------------------- |
| id              | integer | primary key        | ãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ID                |
| title           | string  | null: false,       | ã‚¿ã‚¤ãƒˆãƒ«     |
| content         | text    | null: false,       | å†…å®¹ |
| image           |  ActiveStorage |   ---     | ãƒãƒŠãƒ¼ç”»åƒ |

â€»ç”»åƒã¯ ActiveStorage ã«ã‚ˆã‚Šåˆ¥ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†ã•ã‚Œã‚‹ãŸã‚ã€ã‚«ãƒ©ãƒ ã¨ã—ã¦ã¯å«ã¾ã‚Œã¾ã›ã‚“ã€‚ãƒ¢ãƒ‡ãƒ«å´ã§ `has_one_attached :image` ã‚’å®šç¾©ã—ã¾ã™ã€‚


## Coupon ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆã‚¯ãƒ¼ãƒãƒ³æƒ…å ±ï¼‰

| ã‚«ãƒ©ãƒ å        | å‹       | ã‚ªãƒ—ã‚·ãƒ§ãƒ³               | èª¬æ˜                                |
|---------------|----------|--------------------------|-------------------------------------|
| id            | integer  | primary key              | ã‚¯ãƒ¼ãƒãƒ³ID                          |
| name          | string   | null: false              | ã‚¯ãƒ¼ãƒãƒ³å                          |
| discount_rate | integer  | null: false              | å‰²å¼•ç‡ï¼ˆ10 â†’ 10%å‰²å¼•ï¼‰              |
| expires_at    | datetime | null: false              | æœ‰åŠ¹æœŸé™ï¼ˆã“ã®æ—¥æ™‚ã‚’éãã‚‹ã¨ç„¡åŠ¹ï¼‰  |

### ğŸ“ æ³¨æ„

- `discount_rate` ã¯æ•´æ•°å‹ã§ç®¡ç†ã—ã€`10` ã¨ã™ã‚Œã°ã€Œ10%å‰²å¼•ã€ã‚’æ„å‘³ã—ã¾ã™ã€‚
- `expires_at` ã«ã‚ˆã£ã¦æœ‰åŠ¹æœŸé™ã‚’è¨­å®šã—ã€éããŸã‚¯ãƒ¼ãƒãƒ³ã¯ç„¡åŠ¹ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚
- datetimeå‹ã¯ç§’æ•°ã¾ã§æ‰±ã†ã“ã¨ãŒã§ãã‚‹ãŒã€ä»Šå›ã¯æ—¥ä»˜ã®ã¿ã®å®Ÿè£…ã¨ã™ã‚‹ã€‚


## Coupon_assignment ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ã‚¯ãƒ¼ãƒãƒ³é…å¸ƒï¼‰

| ã‚«ãƒ©ãƒ å     | å‹         | ã‚ªãƒ—ã‚·ãƒ§ãƒ³                          | èª¬æ˜                                 |
|------------|------------|-----------------------------------|--------------------------------------|
| id         | integer    | primary key                       | å‰²ã‚Šå½“ã¦ID                            |
| user       | references | null: false, foreign_key: true    | ã‚¯ãƒ¼ãƒãƒ³ã‚’å—ã‘å–ã£ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆusers.idï¼‰ |
| coupon     | references | null: false, foreign_key: true    | å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¯ãƒ¼ãƒãƒ³ï¼ˆcoupons.idï¼‰   |

### ğŸ“ æ³¨æ„

- ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ `users` ã¨ `coupons` ã® **ä¸­é–“ãƒ†ãƒ¼ãƒ–ãƒ«**ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚
- ã‚¯ãƒ¼ãƒãƒ³ã¯ç™»éŒ²æ™‚ã«å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¸€æ‹¬ã§é…å¸ƒã•ã‚Œã¾ã™ã€‚
- ã‚¯ãƒ¼ãƒãƒ³ãŒã€Œä½¿ç”¨ã•ã‚ŒãŸã‹ã©ã†ã‹ã€ã¯ `orders` ãƒ†ãƒ¼ãƒ–ãƒ«ã® `coupon_assignment_id` ã‚’å‚ç…§ã—ã¦åˆ¤å®šã—ã¾ã™ã€‚
- `used` ãƒ•ãƒ©ã‚°ç­‰ã®ã‚«ãƒ©ãƒ ã¯è¨­ã‘ãšã€å¸¸ã« `orders` çµŒç”±ã§è¨ˆç®—ãƒ»åˆ¤å®šã§ãã‚‹ã€‚(ä½¿ç”¨ã•ã‚ŒãŸã¨ãã«ãã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ¶ˆã™ã»ã†ãŒã‚ˆã„)
- åŒã˜ã‚¯ãƒ¼ãƒãƒ³ã‚’åŒã˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é‡è¤‡ç™»éŒ²ã—ãªã„ã‚ˆã†ã«ã€æ¬¡ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã‚’åŠ ãˆã‚‹ã¨å®‰å…¨ã§ã™ï¼š

```ruby
add_index :coupon_assignments, [:user_id, :coupon_id], unique: true
```



# ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒé–“é•ãˆã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã™ã¹ãã§ã‚ã‚‹(2025/5/20 è¿½è¨˜)
## ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
### Users ãƒ†ãƒ¼ãƒ–ãƒ«
* ~~has_many :items~~
* has_many :orders

### Items ãƒ†ãƒ¼ãƒ–ãƒ«
* ~~belongs_to :user~~
* ~~has_many :orders~~
* has_one :orders

### Orders ãƒ†ãƒ¼ãƒ–ãƒ«
* belongs_to :user
* belongs_to :item
* has_one :delivery_adress

### Delivery_adress ãƒ†ãƒ¼ãƒ–ãƒ«
* belongs_to :order